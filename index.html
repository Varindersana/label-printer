<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Label Printer ‚òÅÔ∏è</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --border: #e2e8f0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f1f5f9;
            color: var(--dark);
            line-height: 1.6;
        }
        header {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-size: 24px; font-weight: bold; color: var(--primary); }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; }
        .nav-tab { padding: 12px 24px; background: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .nav-tab.active { background-color: var(--primary); color: white; }
        .nav-tab:hover:not(.active) { background-color: var(--light); }
        .main-content { background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); min-height: 500px; }
        .sync-status { background: #e3f2fd; border: 1px solid #bbdefb; border-radius: 5px; padding: 10px; margin: 10px 0; font-size: 14px; }
        .syncing { background: #fff3e0; border-color: #ffe0b2; }
        .error { background: #ffebee; border-color: #ffcdd2; }
        .success { background: #e8f5e8; border-color: #c8e6c9; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">Label Printer ‚òÅÔ∏è</div>
            <div class="status-bar" id="printerStatus">Printer: Not Connected</div>
        </header>

        <div class="sync-status" id="syncStatus">üîÑ Ready to connect to your Google Sheet</div>

        <div class="nav-tabs">
            <button class="nav-tab active" id="sectionsTab">Sections</button>
            <button class="nav-tab" id="addTab">Add Product</button>
            <button class="nav-tab" id="printTab">Print Label</button>
            <button class="btn btn-outline" id="refreshBtn">üîÑ Sync Now</button>
        </div>

        <div class="main-content">
            <div id="sections-page">
                <h2>Product Sections</h2>
                <div id="sectionsGrid"></div>
            </div>
        </div>
    </div>

<script>
const sheetId = '1548yioOPYNQzQvcr8dt4iJ3v4KgjzHSw-XaBbcYQhZY';
const syncStatus = document.getElementById('syncStatus');
const refreshBtn = document.getElementById('refreshBtn');
let products = [];

function updateSyncStatus(message, type = 'info') {
  syncStatus.textContent = message;
  syncStatus.className = 'sync-status ' + (type || '');
}

function saveProducts() {
  localStorage.setItem('labelProducts', JSON.stringify(products));
}

function loadSections() {
  const grid = document.getElementById('sectionsGrid');
  grid.innerHTML = '';
  products.forEach(p => {
    const div = document.createElement('div');
    div.textContent = `${p.productName} ‚Äî ${p.section} (${p.expiryDays} days)`;
    div.style.padding = '10px';
    div.style.borderBottom = '1px solid #e2e8f0';
    grid.appendChild(div);
  });
}

async function loadProductsFromGoogleSheet() {
  try {
    updateSyncStatus('üîÑ Fetching data from Google Sheets...', 'syncing');
    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;
    const res = await fetch(url);
    const text = await res.text();

    const jsonStart = text.indexOf('{');
    const jsonEnd = text.lastIndexOf('}');
    if (jsonStart === -1 || jsonEnd === -1) throw new Error('Invalid sheet format');

    const json = JSON.parse(text.substring(jsonStart, jsonEnd + 1));
    const rows = json.table.rows || [];
    products = rows.map(r => {
      const c = r.c;
      return {
        id: c[0]?.v || Date.now(),
        productName: c[1]?.v || '',
        section: c[2]?.v || '',
        expiryDays: parseInt(c[3]?.v || 7)
      };
    }).filter(p => p.productName);

    saveProducts();
    loadSections();
    updateSyncStatus(`‚úÖ Synced ${products.length} products from Google Sheets`, 'success');
  } catch (err) {
    console.error('Error syncing Google Sheet:', err);
    updateSyncStatus('‚ùå Error syncing Google Sheet', 'error');
  }
}

refreshBtn.addEventListener('click', loadProductsFromGoogleSheet);

window.addEventListener('DOMContentLoaded', () => {
  const stored = localStorage.getItem('labelProducts');
  if (stored) {
    products = JSON.parse(stored);
    loadSections();
  }
  loadProductsFromGoogleSheet();
});
</script>
</body>
</html>
